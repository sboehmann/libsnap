#include <libsnap/snap.h>
#include <stdio.h>

int main(int argc, char **argv)
{
    SNAP_UNUSED( argc );
    SNAP_UNUSED( argv );

    snap_t snap;
    snap_init( &snap );

    uint8_t data[] = {
        0x54, 0x00, 0x0D, 0x49, 0x66, 0x20, 0x61, 0x20, 0x70, 0x61, 0x63, 0x6B,
        0x65, 0x74, 0x20, 0x68, 0x69, 0x74, 0x73, 0x20, 0x61, 0x20, 0x70, 0x6F,
        0x63, 0x6B, 0x65, 0x74, 0x20, 0x6F, 0x6E, 0x20, 0x61, 0x20, 0x73, 0x6F,
        0x63, 0x6B, 0x65, 0x74, 0x20, 0x6F, 0x6E, 0x20, 0x61, 0x20, 0x70, 0x6F,
        0x72, 0x74, 0x2C, 0x20, 0x61, 0x6E, 0x64, 0x20, 0x74, 0x68, 0x65, 0x20,
        0x62, 0x75, 0x73, 0x20, 0x69, 0x73, 0x20, 0x69, 0x6E, 0x74, 0x65, 0x72,
        0x72, 0x75, 0x70, 0x74, 0x65, 0x64, 0x20, 0x61, 0x6E, 0x64, 0x20, 0x74,
        0x68, 0x65, 0x20, 0x69, 0x6E, 0x74, 0x65, 0x72, 0x72, 0x75, 0x70, 0x74,
        0x27, 0x73, 0x20, 0x6E, 0x6F, 0x74, 0x20, 0x63, 0x61, 0x75, 0x67, 0x68,
        0x74, 0x2C, 0x20, 0x74, 0x68, 0x65, 0x6E, 0x20, 0x74, 0x68, 0x65, 0x20,
        0x73, 0x6F, 0x63, 0x6B, 0x65, 0x74, 0x20, 0x70, 0x61, 0x63, 0x6B, 0x65,
        0x74, 0x20, 0x70, 0x6F, 0x63, 0x6B, 0x65, 0x74, 0x20, 0x68, 0x61, 0x73,
        0x20, 0x61, 0x6E, 0x20, 0x65, 0x72, 0x72, 0x6F, 0x72, 0x20, 0x74, 0x6F,
        0x20, 0x72, 0x65, 0x70, 0x6F, 0x72, 0x74, 0x2E, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
    };

    size_t data_size = sizeof( data ) / sizeof( data[ 0 ] );
    size_t data_pos = 0;

    size_t response_size = snap_decode_response_bound( &snap, data_size );
    uint8_t *response = malloc( response_size );
    size_t response_pos = 0;

    size_t result_size = snap_decode_result_bound( &snap, data_size );
    uint8_t *result = malloc( result_size );
    size_t result_pos = 0;

    snap_decode( &snap, data, &data_pos, data_size,
                        result, &result_pos, result_size,
                        response, &response_pos, response_size );


    printf( "Input: " );
    for(size_t i = 0; i < data_size; ++i) {
        if( i % 12 == 0 ) {
            printf( "\n    " );
        }
        printf( "0x%02X", data[ i ] );
        if( i < data_size - 1 ) {
            printf( ", " );
        }
    }

    printf( "\n\nResponse: " );
    for(size_t i = 0; i < response_pos; ++i) {
        if( i % 12 == 0 ) {
            printf( "\n    " );
        }
        printf( "0x%02X", response[ i ] );
        if( i < response_pos - 1 ) {
            printf( ", " );
        }
    }

    printf( "\n\nResult: " );
    for(size_t i = 0; i < result_pos; ++i) {
        if( i % 75 == 0 ) {
            printf( "\n    " );
        }
        printf( "%c", result[ i ] );
    }
    printf( "\n" );
}

// kate: word-wrap off; encoding utf-8; indent-width 4; tab-width 4; line-numbers on; mixed-indent off; remove-trailing-space-save on; replace-tabs-save on; replace-tabs on; space-indent on;
// vim: set spell et sw=4 ts=4 nowrap cino=l1,cs,U1: